<!DOCTYPE html>
<html lang="cn">
<head>
    <meta charset="UTF-8">
    <title>局部换图-梦沃大点兵v5</title>
    <meta charset="UTF-8">
    <meta name="description" content="你可以制作自己的梦沃高手的图">
    <meta name="keywords" content="制作, 图片, 梦沃, 高玩, 抠图, 局部, 换图">
    <meta name="author" content="文西科技有限公司">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://guarp.github.io/hlp/">
    <meta property="og:title" content="梦沃未来-局部换图">
    <meta property="og:description" content="你可以制作自己的梦沃高手的图">
    <meta property="og:image" content="https://guarp.github.io/hlp/ico.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://guarp.github.io/hlp/">
    <meta property="twitter:title" content="梦沃未来-局部换图">
    <meta property="twitter:description" content="你可以制作自己的梦沃高手的图">
    <meta property="twitter:image" content="https://guarp.github.io/hlp/ico.png">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            padding: 20px;
        }
        #uploadContainer {
            margin: 20px;
            
        }

        #buttonContainer {
            display: flex;
            justify-content: center; /* 水平居中 */
            flex-wrap: wrap; /* 允许按钮换行 */
            gap: 50px; /* 设置按钮之间的间距 */
        }

        #viewImage {
            display: none;
            margin-top: 20px;
            padding: 10px 20px;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-left: auto;
            margin-right: auto;
        }

        #viewImage:hover {
            background-color: #0056b3;
        }

        #loadingIndicator {
            display: none;
        }

        #loadingIndicator img {
            width: 100px;
            height: auto;
            margin-top: 20px;
        }
        #progressBar {
            width: 100%;
            background-color: #ddd;
        }

        #progressBar div {
            height: 20px;
            width: 0%;
            background-color: #4CAF50;
            text-align: center;
            line-height: 20px;
            color: white;
        }

        #browseImage {
            display: none; /* 初始时隐藏 */
            margin-top: 20px;
            padding: 10px 20px;
            color: white; /* 文字颜色 */
            background-color: #28a745; /* 按钮背景颜色，可以根据需要更改 */
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-left: auto;
            margin-right: auto;
            display: block;
        }

        #browseImage:hover {
        background-color: #218838; /* 鼠标悬停时的背景颜色 */
        }

        .custom-file-upload {
            border: 1px solid #b89b9b;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background-color: rgb(255, 178, 238);
            border-radius: 5px;
            margin-top: 20px;
        }
        .custom-file-upload2 {
            border: 1px solid #b89b9b;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background-color: rgb(233, 203, 54);
            border-radius: 5px;
            margin-top: 20px;
        }
        .custom-file-upload3 {
            border: 1px solid #b89b9b;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background-color: rgb(233, 54, 78);
            border-radius: 5px;
            margin-top: 20px;
        }
        .custom-file-upload4 {
            border: 1px solid #b89b9b;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background-color: rgb(54, 233, 167);
            border-radius: 5px;
            margin-top: 20px;
        }
        .custom-file-upload5 {
            border: 1px solid #b89b9b;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background-color: rgb(54, 224, 233);
            border-radius: 5px;
            margin-top: 20px;
        }
        .custom-file-upload6 {
            border: 1px solid #b89b9b;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background-color: rgb(54, 114, 233);
            border-radius: 5px;
            margin-top: 20px;
        }
        .custom-file-upload7 {
            border: 1px solid #b89b9b;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background-color: rgb(212, 192, 137);
            border-radius: 5px;
            margin-top: 20px;
        }
        #resizeOptions {
            border: 2px solid #b89b9b; /* 边框颜色和宽度 */
            padding: 10px;
            margin-top: 20px;
            background-color: rgb(255, 255, 255); /* 背景颜色 */
            border-radius: 5px; /* 边框圆角 */
            display: inline-block; /* 使边框紧贴内容 */
        }

        #resizeOptions label {
            margin-left: 10px;
            font-size: 14px;
            }

        #resizeOptions input[type="radio"] {
            margin-left: 5px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <h1 text-align: center;>局部换图之梦沃大点兵<br>V5</h1>
    <hr>
    <div id="uploadContainer">
        <div id="buttonContainer">
            <label for="uploadImage" class="custom-file-upload">
            高手玩家
        </label>
        
        <label for="uploadImage2" class="custom-file-upload2">
            虚空茅厕
        </label>
        
        <label for="uploadImage3" class="custom-file-upload3">
            萝莉の王
        </label>
        <!-- </div><div id="buttonContainer"> 其实是换行 -->
        <label for="uploadImage4" class="custom-file-upload4">
            纹希看片
        </label>
        
        <label for="uploadImage5" class="custom-file-upload5">
            大牛尚钓
        </label>

        <label for="uploadImage6" class="custom-file-upload6">
            唐王聚口
        </label>

        <label for="uploadImage7" class="custom-file-upload7">
            文明繁荣
        </label>
        </div>
        
        <br><br>

        <div id="resizeOptions">
            <input type="radio" id="forceSize" name="resizeOption" value="forceSize" checked>
            <label for="forceSize">强制拉伸图片</label><br>
            <input type="radio" id="alignShortEdge" name="resizeOption" value="alignShortEdge">
            <label for="alignShortEdge">对齐图片短边</label>
            <br><br>
            <input type="checkbox" id="mirrorImage" name="mirrorImage">
            <label for="mirrorImage">镜像反转图片</label>
        </div>

        <input type="file" id="uploadImage" accept="image/*" style="display: none;"/>
        <input type="file" id="uploadImage2" accept="image/*" style="display: none;"/>
        <input type="file" id="uploadImage3" accept="image/*" style="display: none;"/>
        <input type="file" id="uploadImage4" accept="image/*" style="display: none;"/>
        <input type="file" id="uploadImage5" accept="image/*" style="display: none;"/>
        <input type="file" id="uploadImage6" accept="image/*" style="display: none;"/>
        <input type="file" id="uploadImage7" accept="image/*" style="display: none;"/>

        <br><br>
        单击按钮上传图片
        <br>
        请注意: 首次生成时间较长, 科学上网以加速生成时间
    </div>
    
    <div id="loadingIndicator"></div>
    <div id="progressBar"><div>0%</div></div>
    <button id="viewImage" style="display: none;">下载图片</button>
    <button id="browseImage" style="display: none;">浏览图片</button>
    <div id="imageContainer" style="margin-top: 20px; display: none;">
        <img id="resultImage" src="" alt="生成的图片" style="max-width: 100%; height: auto;"/>
    </div>

    

    <script>
    
    function loadImage(userFile, overlayUrl, targetWidth, targetHeight, shiftX, shiftY, shortEdgeHeight, shortEdgeWidth, rotationDegrees) { 

        const loadingIndicator = document.getElementById('loadingIndicator');
        const loadingText = document.createElement('div'); // 创建一个新的div来显示文本

        document.getElementById('uploadContainer').style.display = 'none';
        loadingIndicator.style.display = 'block';
        loadingIndicator.innerHTML = ''; // 清空任何现有内容
        loadingIndicator.appendChild(loadingText); // 添加新的文本div
        loadingText.textContent = '正在连接...'; // 初始文本
        document.getElementById('loadingIndicator').style.display = 'block';
        document.getElementById('progressBar').style.display = 'block';

    const xhr = new XMLHttpRequest();
    xhr.open('GET', overlayUrl, true);
    xhr.responseType = 'blob';

    xhr.onprogress = function (e) {
        if (e.lengthComputable) {
            const percentComplete = Math.round((e.loaded / e.total) * 100);
            document.getElementById('progressBar').firstChild.style.width = percentComplete + '%';
            document.getElementById('progressBar').firstChild.textContent = percentComplete + '%';
            loadingText.textContent = '正在下载图片...';
        }
    };

    xhr.onload = function () {
        if (this.status === 200) {
            loadingText.textContent = '下载已完成, 正在处理图片...';
            const overlayBlob = new Blob([this.response]);
            processImage(userFile, overlayBlob, targetWidth, targetHeight, shiftX, shiftY, shortEdgeHeight, shortEdgeWidth, rotationDegrees);
        }
    };

    xhr.onerror = function () {
        alert('图片加载失败');
    };

    xhr.send();
}

function processImage(userFile, overlayBlob, targetWidth, targetHeight, shiftX, shiftY, shortEdgeHeight, shortEdgeWidth, rotationDegrees) {
    const img = new Image();
    img.onload = function () {
        const canvas = document.createElement('canvas');
        canvas.width = targetWidth;
        canvas.height = targetHeight;
        const ctx = canvas.getContext('2d');

        let width = img.width;
        let height = img.height;

        const resizeOption = document.querySelector('input[name="resizeOption"]:checked').value;

        if (resizeOption === 'forceSize') {
        height = shortEdgeHeight;
        width = shortEdgeWidth;
        } else {
            if (width > height) {
                width *= shortEdgeHeight / height;
                height = shortEdgeHeight;
            } else {
                height *= shortEdgeWidth / width;
                width = shortEdgeWidth;
            }
        }

        const posX = (targetWidth - width) / 2 + shiftX;
        const posY = (targetHeight - height) / 2 + shiftY;

        ctx.translate(posX + width / 2, posY + height / 2);
        ctx.rotate(-rotationDegrees * Math.PI / 180);

        const mirror = document.getElementById('mirrorImage').checked;
        if (mirror) {
            ctx.scale(-1, 1); // 水平镜像反转
        }

        ctx.drawImage(img, -width / 2, -height / 2, width, height);

        if (mirror) {
            ctx.scale(-1, 1);
        }

        ctx.rotate(rotationDegrees * Math.PI / 180);
        ctx.translate(-posX - width / 2, -posY - height / 2);

        const overlayImg = new Image();
        overlayImg.onload = function () {
            ctx.drawImage(overlayImg, 0, 0, targetWidth, targetHeight);

            canvas.toBlob(function (blob) {
                const viewButton = document.getElementById('viewImage');
                const browseButton = document.getElementById('browseImage');
                const imageContainer = document.getElementById('imageContainer');
                const resultImage = document.getElementById('resultImage');
                const loadingIndicator = document.getElementById('loadingIndicator');
                const progressBar = document.getElementById('progressBar');

                loadingIndicator.style.display = 'none';
                progressBar.style.display = 'none';
                viewButton.style.display = 'block';
                browseButton.style.display = 'block';

                browseButton.onclick = function () {
                    resultImage.src = URL.createObjectURL(blob);
                    imageContainer.style.display = 'block';
                };

                viewButton.textContent = '下载图片';
                viewButton.onclick = function () {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'processed_image.png';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                };
            }, 'image/png');
        };
        overlayImg.src = URL.createObjectURL(overlayBlob);
    };

    img.src = URL.createObjectURL(userFile);
}


document.getElementById('progressBar').style.display = 'none';
document.getElementById('uploadImage').addEventListener('change', function (e) {
    loadImage(e.target.files[0], 'https://guarp.github.io/hlp/sjmh.png', 3968, 2976, -280, 35, 605, 960, 1.7);
});
document.getElementById('uploadImage2').addEventListener('change', function (e) {
    loadImage(e.target.files[0], 'https://guarp.github.io/hlp/losn.png', 1080, 1906, 390, -750, 555, 400, 2);
});
document.getElementById('uploadImage3').addEventListener('change', function (e) {
    loadImage(e.target.files[0], 'https://guarp.github.io/hlp/llw.png', 3456, 4608, -350, 0, 588, 1050, -3);
});
document.getElementById('uploadImage4').addEventListener('change', function (e) {
    loadImage(e.target.files[0], 'https://guarp.github.io/hlp/wjkp.png', 600, 800, -97, -42, 160, 245, -4);
});
document.getElementById('uploadImage5').addEventListener('change', function (e) {
    loadImage(e.target.files[0], 'https://guarp.github.io/hlp/daniu.png', 433, 577, 0, 0, 577, 433, 0);
});
document.getElementById('uploadImage6').addEventListener('change', function (e) {
    loadImage(e.target.files[0], 'https://guarp.github.io/hlp/twdj.png', 1920, 1080, 588, -95, 350, 375, -19);
});
document.getElementById('uploadImage7').addEventListener('change', function (e) {
    loadImage(e.target.files[0], 'https://guarp.github.io/hlp/frzz.png', 1276, 1702, 10, -50, 1702, 1276, 0);
});
    </script>
</body>
</html>
